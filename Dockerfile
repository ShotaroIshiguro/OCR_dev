# --------------------
# 1. ベースイメージの指定
# --------------------
# Python 3.10のスリムバージョンをベースにします。
FROM python:3.10-slim

# --------------------
# 2. 作業ディレクトリの設定
# --------------------
# コンテナ内の作業ディレクトリを作成し、以降のコマンドの実行場所とします。
WORKDIR /app

# --------------------
# 3. システムライブラリのインストール
# --------------------
# OpenCVが動作するために必要なシステムライブラリをインストールします。
RUN apt-get update && apt-get install -y \
    libgl1 \
    libglib2.0-0 \
    && rm -rf /var/lib/apt/lists/*

# --------------------
# 4. Pythonライブラリのインストール
# --------------------
# まずrequirements.txtをコピーし、ライブラリをインストールします。
# この順番にすることで、コードを変更してもライブラリの再インストールが不要になり、ビルドが高速化します。
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# --------------------
# 5. アプリケーションコードとモデルのコピー
# --------------------
# カレントディレクトリにある全てのファイル（.pyスクリプト、.ptモデルファイルなど）をコンテナにコピーします。
COPY . .

# --------------------
# 6. コンテナ実行コマンドの指定
# --------------------
# コンテナが起動したときに、このPythonスクリプトを実行します。
# CMD ["python", "YOLO_EASY_PyMuPDF_V1_EVENT.py"]
CMD ["/bin/sh", "-c", "printenv"]